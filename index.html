<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>SPARQL JSON to HTML Table</title>
    </head>
    <body>

        <h1>Results</h1>
        <table border="1" id="resultsTable">
            <!-- ヘッダとボディはJavaScriptで動的に生成されます -->
        </table>

        <script>
         async function fetchDatabySPARQL() {
             const endpointUrl = 'https://orth.dbcls.jp/sparql-orth4';
             const sparqlQuery = `
PREFIX hgnc: <http://identifiers.org/hgnc/>
PREFIX biolink: <https://w3id.org/biolink/vocab/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?gene ?label ?symbol ?phenotype ?phenotype_label
WHERE {
  VALUES ?hgnc { hgnc:16435 }
  ?hgnc biolink:orthologous_to ?gene .
  ?gene rdfs:label ?label ;
        biolink:symbol ?symbol ;
        biolink:has_phenotype ?phenotype .
  ?phenotype rdfs:label ?phenotype_label .
  FILTER(CONTAINS(?label, ' '))
}
             `;

             const response = await fetch(endpointUrl, {
                 method: 'POST',
                 headers: {
                     'Accept': 'application/sparql-results+json',
                     'Content-Type': 'application/x-www-form-urlencoded'
                 },
                 body: `query=${encodeURIComponent(sparqlQuery)}`
             });

             return await response.json();
         }

         function renderTable(data) {
             const table = document.getElementById('resultsTable');
             
             // ヘッダの作成
             const thead = document.createElement('thead');
             const headerRow = document.createElement('tr');
             data.head.vars.forEach(variable => {
                 const th = document.createElement('th');
                 th.textContent = variable;
                 headerRow.appendChild(th);
             });
             thead.appendChild(headerRow);
             table.appendChild(thead);

             // ボディの作成
             const tbody = document.createElement('tbody');
             data.results.bindings.forEach(binding => {
                 const tr = document.createElement('tr');
                 data.head.vars.forEach(variable => {
                     const td = document.createElement('td');
                     td.textContent = binding[variable].value;
                     tr.appendChild(td);
                 });
                 tbody.appendChild(tr);
             });
             table.appendChild(tbody);
         }

         async function init() {
             const data = await fetchDatabySPARQL();
             renderTable(data);
         }

         // 初期化関数の実行
         init();
        </script>

    </body>
</html>
